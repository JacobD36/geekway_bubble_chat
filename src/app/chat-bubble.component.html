<!-- Botón flotante -->
<button
  (click)="toggleChat()"
  [class]="'fixed w-14 h-14 bg-purple-500 hover:bg-purple-600 rounded-full shadow-xl flex items-center justify-center transition-all duration-300 z-50 hover:scale-110 animate-bounce-in ' +
          (position === 'bottom-left' ? 'bottom-6 left-6' : 'bottom-6 right-6')"
>
  @if (isOpen()) {
    <svg class="w-6 h-6 text-white transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
  } @else {
    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
    </svg>
  }
</button>

<!-- Burbuja de chat -->
@if (isOpen()) {
  <div [class]="'fixed bottom-24 w-96 h-[650px] bg-white rounded-2xl shadow-2xl z-40 flex flex-col animate-slide-up border border-gray-200 overflow-hidden ' +
              (position === 'bottom-left' ? 'left-6' : 'right-6')"
  >

    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-400 to-purple-500 p-4">
      <div class="flex items-center justify-center">
        <div class="text-center">
          <h3 class="text-white text-lg font-bold">GeekWay Chat</h3>
        </div>
      </div>
    </div>

    <!-- Messages Area -->
    <div class="flex-1 p-4 overflow-y-auto space-y-4 bg-gray-50 messages-container custom-scrollbar">
      @for (message of messages(); track message.id) {
        @if (message.sender === 'bot') {
          <!-- Mensaje del Bot - Alineado a la izquierda -->
          <div class="flex items-end space-x-2 justify-start">
            <div class="message-avatar bot-avatar">
              <svg class="avatar-icon bot-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2L13.09 8.26L20 9L13.09 9.74L12 16L10.91 9.74L4 9L10.91 8.26L12 2Z"/>
                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z"/>
                <path d="M12 16C13.1 16 14 16.9 14 18C14 19.1 13.1 20 12 20C10.9 20 10 19.1 10 18C10 16.9 10.9 16 12 16Z"/>
              </svg>
            </div>
            <div class="message-content bot-message">
              <p class="text-sm">{{ message.text }}</p>
            </div>
          </div>
        } @else {
          <!-- Mensaje del Usuario - Alineado a la derecha -->
          <div class="flex items-end space-x-2 justify-end">
            <div class="message-content user-message">
              <p class="text-sm">{{ message.text }}</p>
            </div>
            <div class="message-avatar user-avatar">
              <svg class="avatar-icon user-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </div>
          </div>
        }
      }
    </div>

    <!-- Input Area -->
    <div class="p-4 bg-white border-t border-gray-200">
      <div class="flex items-center space-x-2">
        <input
          type="text"
          [ngModel]="inputMessage()"
          (ngModelChange)="inputMessage.set($event)"
          (keypress)="onKeyPress($event)"
          placeholder="Escribe aquí tu mensaje..."
          class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent transition-all duration-200 text-sm"
        />
        <button
          (click)="sendMessage()"
          class="w-10 h-10 bg-purple-500 hover:bg-purple-600 rounded-full flex items-center justify-center transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
          [disabled]="!inputMessage().trim()"
        >
          <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
          </svg>
        </button>
      </div>
    </div>
  </div>
}
