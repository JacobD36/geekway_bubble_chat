class GeekWayChat{constructor(){this.widget=null,this.isOpen=!1,this.messages=[],this.sessionId=null,this.apiKey=null,this.apiBaseUrl="http://localhost:3000/api/v1",this.isLoading=!1}static init(n){return console.log("🚀 GeekWayChat.init() - Vanilla JS version",n),GeekWayChat.instance&&GeekWayChat.instance.destroy(),GeekWayChat.instance=new GeekWayChat,GeekWayChat.instance.createWidget(n),GeekWayChat.instance}createWidget(n){n.theme;const t=n.position||"bottom-right",e=n.welcomeMessage||"¡Hola! Soy el asistente de GeekWay. ¿En qué puedo ayudarte?";this.apiKey=n.apiKey,this.apiBaseUrl=n.apiBaseUrl||"http://localhost:3000/api/v1",this.apiKey?(this.messages=[{id:1,text:e,sender:"bot",timestamp:new Date}],this.injectStyles(),this.widget=document.createElement("div"),this.widget.className=`geekway-chat-widget ${this.getPositionClass(t)}`,this.widget.innerHTML=`\n      <button class="chat-button">\n        <svg class="chat-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>\n        </svg>\n        <svg class="close-icon hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n        </svg>\n      </button>\n\n      <div class="chat-window hidden">\n        <div class="chat-header">\n          <h3>GeekWay Chat</h3>\n        </div>\n        <div class="chat-messages" id="chat-messages">\n          ${this.renderMessages()}\n        </div>\n        <div class="chat-input">\n          <input type="text" id="message-input" placeholder="Escribe aquí tu mensaje..." />\n          <button id="send-button">\n            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>\n            </svg>\n          </button>\n        </div>\n      </div>\n    `,document.body.appendChild(this.widget),this.setupEvents(),console.log("✅ GeekWay Chat Widget creado (Vanilla JS)",{position:t,class:this.getPositionClass(t)})):console.error("❌ GeekWay Chat: API Key es requerida")}getPositionClass(n){switch(n){case"bottom-left":return"position-bottom-left";case"top-right":return"position-top-right";case"top-left":return"position-top-left";default:return"position-bottom-right"}}renderMessages(){return this.messages.map(n=>`\n      <div class="message ${n.sender}">\n        <div class="message-avatar">\n          ${"bot"===n.sender?this.getBotIcon():this.getUserIcon()}\n        </div>\n        <div class="message-content">\n          <span class="message-text">${n.text}</span>\n        </div>\n      </div>\n    `).join("")}getBotIcon(){return'\n      <svg class="avatar-icon bot-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n        <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/>\n        <circle cx="9" cy="10" r="1.5"/>\n        <circle cx="15" cy="10" r="1.5"/>\n        <path d="M8 14c0 2.21 1.79 4 4 4s4-1.79 4-4H8z"/>\n      </svg>\n    '}getUserIcon(){return'\n      <svg class="avatar-icon user-icon" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">\n        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>\n      </svg>\n    '}setupEvents(){if(!this.widget)return;const n=this.widget.querySelector(".chat-button"),t=this.widget.querySelector(".chat-window"),e=this.widget.querySelector("#message-input"),i=this.widget.querySelector("#send-button"),s=this.widget.querySelector(".chat-icon"),o=this.widget.querySelector(".close-icon");n.addEventListener("click",()=>{this.isOpen=!this.isOpen,this.isOpen?(t.classList.remove("hidden"),s.classList.add("hidden"),o.classList.remove("hidden"),setTimeout(()=>this.scrollToBottom(),100)):(t.classList.add("hidden"),s.classList.remove("hidden"),o.classList.add("hidden"))});const a=async()=>{const n=e.value.trim();if(n&&!this.isLoading){this.isLoading=!0,e.disabled=!0,i.disabled=!0,this.messages.push({id:Date.now(),text:n,sender:"user",timestamp:new Date}),e.value="",this.updateMessages(),this.scrollToBottom(),this.showTypingIndicator();try{const t=await this.callChatAPI(n);if(this.hideTypingIndicator(),!(t&&t.data&&t.data.messages))throw new Error("Respuesta inválida de la API");{const n=t.data.messages.filter(n=>"assistant"===n.role);if(!(n.length>0))throw new Error("No se encontraron mensajes del asistente");{const e=n[n.length-1];let i="";if(e.content&&e.content.length>0){const n=e.content.find(n=>"text"===n.type);n&&n.text&&n.text.value&&(i=n.text.value)}if(!i)throw new Error("Respuesta vacía del asistente");this.messages.push({id:Date.now(),text:i,sender:"bot",timestamp:new Date}),t.data.session_id&&(this.sessionId=t.data.session_id,console.log("💾 Session ID guardado:",this.sessionId))}}}catch(n){console.error("❌ Error al enviar mensaje:",n),this.hideTypingIndicator(),this.messages.push({id:Date.now(),text:"Lo siento, ha ocurrido un error. Por favor, inténtalo de nuevo.",sender:"bot",timestamp:new Date,isError:!0})}finally{this.isLoading=!1,e.disabled=!1,i.disabled=!1,e.focus(),this.updateMessages(),this.scrollToBottom()}}};i.addEventListener("click",a),e.addEventListener("keypress",n=>{"Enter"===n.key&&a()})}async callChatAPI(n){const t=`${this.apiBaseUrl}/threads/chat`,e={message:n};this.sessionId&&(e.session_id=this.sessionId),console.log("📡 Enviando mensaje a API:",{url:t,body:e});const i=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","x-key":this.apiKey},body:JSON.stringify(e)});if(!i.ok){const n=await i.text();throw new Error(`HTTP ${i.status}: ${n}`)}const s=await i.json();return console.log("✅ Respuesta de API recibida:",s),s}showTypingIndicator(){this.hideTypingIndicator();const n={id:"typing-indicator",text:'<div class="typing-indicator"><span></span><span></span><span></span></div>',sender:"bot",timestamp:new Date,isTyping:!0};this.messages.push(n),this.updateMessages(),this.scrollToBottom()}hideTypingIndicator(){this.messages=this.messages.filter(n=>"typing-indicator"!==n.id),this.updateMessages()}updateMessages(){const n=this.widget?.querySelector("#chat-messages");n&&(n.innerHTML=this.renderMessages())}scrollToBottom(){const n=this.widget?.querySelector("#chat-messages");n&&(n.scrollTop=n.scrollHeight)}injectStyles(){if(document.getElementById("geekway-chat-styles"))return;const n=document.createElement("style");n.id="geekway-chat-styles",n.textContent='\n      .geekway-chat-widget * {\n        box-sizing: border-box;\n        margin: 0;\n        padding: 0;\n      }\n\n      .chat-button {\n        position: fixed;\n        width: 56px;\n        height: 56px;\n        background: #8b5cf6;\n        border: none;\n        border-radius: 50%;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.2);\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        z-index: 9999;\n        transition: all 0.3s ease;\n      }\n\n      .chat-button:hover {\n        background: #7c3aed;\n        transform: scale(1.1);\n      }\n\n      .chat-button svg {\n        width: 24px;\n        height: 24px;\n        color: white;\n      }\n\n      .chat-window {\n        position: fixed;\n        width: 384px;\n        height: 650px;\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 10px 25px rgba(0,0,0,0.2);\n        z-index: 9998;\n        display: flex;\n        flex-direction: column;\n        overflow: hidden;\n        transition: all 0.3s ease;\n        animation: slideUp 0.3s ease-out;\n      }\n\n      @keyframes slideUp {\n        from {\n          opacity: 0;\n          transform: translateY(20px) scale(0.95);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0) scale(1);\n        }\n      }\n\n      .chat-window.hidden {\n        display: none;\n      }\n\n      /* POSICIONAMIENTO BOTTOM-RIGHT (por defecto) */\n      .geekway-chat-widget .position-bottom-right .chat-button,\n      .geekway-chat-widget.position-bottom-right .chat-button {\n        bottom: 24px;\n        right: 24px;\n      }\n\n      .geekway-chat-widget .position-bottom-right .chat-window,\n      .geekway-chat-widget.position-bottom-right .chat-window {\n        bottom: 96px;\n        right: 24px;\n      }\n\n      /* POSICIONAMIENTO BOTTOM-LEFT */\n      .geekway-chat-widget .position-bottom-left .chat-button,\n      .geekway-chat-widget.position-bottom-left .chat-button {\n        bottom: 24px;\n        left: 24px;\n      }\n\n      .geekway-chat-widget .position-bottom-left .chat-window,\n      .geekway-chat-widget.position-bottom-left .chat-window {\n        bottom: 96px;\n        left: 24px;\n      }\n\n      /* POSICIONAMIENTO TOP-RIGHT */\n      .geekway-chat-widget .position-top-right .chat-button,\n      .geekway-chat-widget.position-top-right .chat-button {\n        top: 24px;\n        right: 24px;\n      }\n\n      .geekway-chat-widget .position-top-right .chat-window,\n      .geekway-chat-widget.position-top-right .chat-window {\n        top: 96px;\n        right: 24px;\n      }\n\n      /* POSICIONAMIENTO TOP-LEFT */\n      .geekway-chat-widget .position-top-left .chat-button,\n      .geekway-chat-widget.position-top-left .chat-button {\n        top: 24px;\n        left: 24px;\n      }\n\n      .geekway-chat-widget .position-top-left .chat-window,\n      .geekway-chat-widget.position-top-left .chat-window {\n        top: 96px;\n        left: 24px;\n      }\n\n      .chat-header {\n        background: linear-gradient(135deg, #8b5cf6, #7c3aed);\n        color: white;\n        padding: 16px;\n        text-align: center;\n      }\n\n      .chat-header h3 {\n        font-size: 18px;\n        font-weight: bold;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n      }\n\n      .chat-messages {\n        flex: 1;\n        padding: 16px;\n        overflow-y: auto;\n        background: #f9fafb;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n        display: flex;\n        flex-direction: column;\n      }\n\n      .message {\n        margin-bottom: 16px;\n        display: flex;\n        align-items: flex-end;\n        gap: 8px;\n        width: 100%;\n      }\n\n      .message.bot {\n        justify-content: flex-start;\n        flex-direction: row;\n      }\n\n      .message.user {\n        justify-content: flex-end;\n        flex-direction: row-reverse;\n        margin-left: auto;\n        text-align: right;\n      }\n\n      .message-avatar {\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        flex-shrink: 0;\n        margin-bottom: 2px;\n      }\n\n      .message.bot .message-avatar {\n        background: #8b5cf6;\n        color: white;\n        order: 1;\n      }\n\n      .message.user .message-avatar {\n        background: #3b82f6;\n        color: white;\n        order: 1;\n      }\n\n      .avatar-icon {\n        width: 18px;\n        height: 18px;\n      }\n\n      .bot-icon {\n        color: white;\n      }\n\n      .user-icon {\n        color: white;\n      }\n\n      .message-content {\n        max-width: calc(100% - 40px);\n        padding: 12px 16px;\n        border-radius: 18px;\n        font-size: 14px;\n        line-height: 1.4;\n        order: 2;\n      }\n\n      .message.bot .message-content {\n        background: #e5e7eb;\n        color: #1f2937;\n        border-bottom-left-radius: 4px;\n        margin-left: 0;\n        margin-right: auto;\n        border: 1px solid #d1d5db;\n      }\n\n      .message.user .message-content {\n        background: #3b82f6;\n        color: white;\n        border-bottom-right-radius: 4px;\n        margin-right: 0;\n        margin-left: auto;\n        text-align: left;\n      }\n\n      .chat-input {\n        display: flex;\n        padding: 16px;\n        background: white;\n        border-top: 1px solid #e5e7eb;\n        gap: 8px;\n      }\n\n      #message-input {\n        flex: 1;\n        padding: 12px 16px;\n        border: 1px solid #d1d5db;\n        border-radius: 24px;\n        outline: none;\n        font-size: 14px;\n        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n      }\n\n      #message-input:focus {\n        border-color: #8b5cf6;\n        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);\n      }\n\n      #send-button {\n        width: 40px;\n        height: 40px;\n        background: #8b5cf6;\n        border: none;\n        border-radius: 50%;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: background 0.2s ease;\n      }\n\n      #send-button:hover {\n        background: #7c3aed;\n      }\n\n      #send-button svg {\n        width: 20px;\n        height: 20px;\n        color: white;\n      }\n\n      #send-button:disabled {\n        background: #9ca3af;\n        cursor: not-allowed;\n      }\n\n      #message-input:disabled {\n        background: #f3f4f6;\n        cursor: not-allowed;\n      }\n\n      /* Indicador de escritura */\n      .typing-indicator {\n        display: flex;\n        align-items: center;\n        gap: 4px;\n        padding: 8px 0;\n      }\n\n      .typing-indicator span {\n        width: 8px;\n        height: 8px;\n        background: #9ca3af;\n        border-radius: 50%;\n        animation: typing 1.5s infinite;\n      }\n\n      .typing-indicator span:nth-child(2) {\n        animation-delay: 0.3s;\n      }\n\n      .typing-indicator span:nth-child(3) {\n        animation-delay: 0.6s;\n      }\n\n      @keyframes typing {\n        0%, 60%, 100% {\n          transform: translateY(0);\n          opacity: 0.4;\n        }\n        30% {\n          transform: translateY(-10px);\n          opacity: 1;\n        }\n      }\n\n      .hidden {\n        display: none !important;\n      }\n\n      @media (max-width: 640px) {\n        .chat-window {\n          width: calc(100vw - 32px);\n          height: 80vh;\n          right: 16px !important;\n          left: 16px !important;\n          bottom: 96px !important;\n        }\n      }\n    ',document.head.appendChild(n)}destroy(){this.widget&&(this.widget.remove(),this.widget=null);const n=document.getElementById("geekway-chat-styles");n&&n.remove()}show(){this.widget&&(this.widget.style.display="block")}hide(){this.widget&&(this.widget.style.display="none")}}GeekWayChat.instance=null,window.GeekWayChat=GeekWayChat,console.log("🌍 GeekWayChat (Vanilla JS) disponible globalmente"),console.log("✅ Sin dependencias - Compatibilidad universal");